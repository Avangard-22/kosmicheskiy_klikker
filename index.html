<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <!-- –ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å –¥–ª—è GitHub Pages -->
  <base href="https://avangard-22.github.io/kosmicheskiy_klikker/">
  <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ö–ª–∏–∫–µ—Ä</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  
  <!-- Telegram Web App Integration -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <style>
    /* –°—Ç–∏–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Telegram Web App */
    body {
      background: #000;
    }
    
    @media (max-width: 768px) {
      body {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
      }
    }
  </style>
</head>
<body>
  <!-- Canvas –¥–ª—è –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω–æ–≥–æ —Ñ–æ–Ω–∞ -->
  <canvas id="planetBackgroundCanvas"></canvas>
  <!-- UI -->
  <div id="header">
    <h2 id="gameTitle">‚òø –ú–µ—Ä–∫—É—Ä–∏–π</h2>
  </div>
  <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
  <button id="saveBtn" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É">
    <i class="fas fa-save"></i>
  </button>
  <!-- HUD -->
  <div id="hud-left">
    <div class="hud-item" id="coins"><i class="fas fa-gem"></i> –ö—Ä–∏—Å—Ç–∞–ª–ª—ã: <span id="coins-value">0</span></div>
    <div class="hud-item" id="clickPowerInfo"><i class="fas fa-fist-raised"></i> –°–∏–ª–∞: <span id="clickPower-value">1</span></div>
    <div class="hud-item" id="critChanceInfo"><i class="fas fa-star"></i> –ö—Ä–∏—Ç: <span id="critChance-value">0.1%</span></div>
    <div class="hud-item" id="critMultiplierInfo"><i class="fas fa-star"></i> –ú–Ω–æ–∂: <span id="critMultiplier-value">x2.0</span></div>
  </div>
  <!-- –ü–†–û–ì–†–ï–°–°-–ë–ê–† -->
  <div id="progressContainer">
    <div id="progressBar"></div>
  </div>
  <div id="progressText">–ü—Ä–æ–≥—Ä–µ—Å—Å: 0.00000 / 0.38710 –∞.–µ. (0%)</div>
  <div id="gameArea"></div>
  <div id="levelAnnounce"></div>
  <!-- –ö–ù–û–ü–ö–ò –£–õ–£–ß–®–ï–ù–ò–ô -->
  <button id="upgradeClickBtn" class="upgrade-btn btn-unavailable">
    <i class="fas fa-fist-raised"></i>
    <div class="upgrade-cost">80</div>
  </button>
  <button id="upgradeHelperBtn" class="upgrade-btn btn-unavailable">
    <i class="fas fa-robot"></i>
    <div class="upgrade-cost">1500</div>
  </button>
  <button id="upgradeCritChanceBtn" class="upgrade-btn btn-unavailable">
    <i class="fas fa-star"></i>
    <div class="upgrade-cost">500</div>
  </button>
  <button id="upgradeCritMultBtn" class="upgrade-btn btn-unavailable">
    <i class="fas fa-star"></i>
    <div class="upgrade-cost">800</div>
  </button>
  <button id="upgradeHelperDmgBtn" class="upgrade-btn btn-unavailable">
    <i class="fas fa-bolt"></i>
    <div class="upgrade-cost">1000</div>
  </button>
  <!-- –ö–ù–û–ü–ö–ò –ú–ê–ì–ê–ó–ò–ù–ê -->
  <div id="shopContainer" class="shop-container">
    <button id="shopBtn" class="shop-btn" title="–ú–∞–≥–∞–∑–∏–Ω">
      <i class="fas fa-shopping-cart"></i>
    </button>
    <div id="shopPanel" class="shop-panel">
      <h3>üõí –ú–∞–≥–∞–∑–∏–Ω</h3>
      <div class="shop-item" id="shopTimeWarp">
        <i class="fas fa-hourglass-half"></i>
        <span>–ò—Å–∫–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ (30—Å–µ–∫)</span>
        <div class="shop-cost">250</div>
      </div>
      <div class="shop-item" id="shopCrystalBoost">
        <i class="fas fa-gem"></i>
        <span>–£—Å–∏–ª–∏—Ç–µ–ª—å –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ (1–º–∏–Ω)</span>
        <div class="shop-cost">400</div>
      </div>
      <div class="shop-item" id="shopPowerSurge">
        <i class="fas fa-bolt"></i>
        <span>–°–∫–∞—á–æ–∫ —Å–∏–ª—ã (45—Å–µ–∫)</span>
        <div class="shop-cost">300</div>
      </div>
    </div>
  </div>
  <!-- –ü–ê–ù–ï–õ–¨ –î–û–°–¢–ò–ñ–ï–ù–ò–ô (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è) -->
  <div id="achievementsContainer" class="achievements-container">
    <button id="achievementsBtn" class="achievements-btn" title="–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è">
      <i class="fas fa-trophy"></i>
    </button>
    <div id="achievementsPanel" class="achievements-panel">
      <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
    </div>
  </div>
  
  <div id="tooltip" class="tooltip"></div>
  <canvas id="particlesCanvas"></canvas>
  
  <!-- –ó–≤—É–∫–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–µ–º base64 –¥–ª—è GitHub Pages) -->
  <audio id="clickSound" preload="auto" src="audio/click.wav"></audio>
  <audio id="breakSound" preload="auto" src="audio/break.wav"></audio>
  <audio id="upgradeSound" preload="auto" src="audio/upgrade.wav"></audio>
  <audio id="comboSound" preload="auto" src="audio/combo.wav"></audio>
  <audio id="helperSound" preload="auto" src="audio/helper.wav"></audio>
  
  <!-- –≠–∫—Ä–∞–Ω—ã -->
  <div id="welcomeScreen">
    <h2>üöÄ –ö–û–°–ú–ò–ß–ï–°–ö–ò–ô –ö–õ–ò–ö–ï–†</h2>
    <p>–†–∞–∑—Ä—É—à–∞–π—Ç–µ –≤–æ—Å—Ö–æ–¥—è—â–∏–µ –±–ª–æ–∫–∏ –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ <strong>–∫–æ—Å–º–∏—á–µ—Å–∫–∏–µ –ö—Ä–∏—Å—Ç–∞–ª–ª—ã</strong>!</p>
    <p>–ö–∞–∂–¥—ã–π –±–ª–æ–∫ —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–¥–∞—Ä–æ–≤ –¥–ª—è —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è.</p>
    <p><strong>–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:</strong></p>
    <p>üåå <strong>–ê—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –µ–¥–∏–Ω–∏—Ü—ã</strong> ‚Äî –ø–µ—Ä–µ–º–µ—â–∞–π—Ç–µ—Å—å –ø–æ –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ</p>
    <p>ü™ê <strong>9 —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞–Ω–µ—Ç</strong> ‚Äî –æ—Ç –ú–µ—Ä–∫—É—Ä–∏—è –¥–æ –ü–ª—É—Ç–æ–Ω–∞</p>
    <p>üöÄ <strong>–£–ª—É—á—à–µ–Ω–∏—è</strong> ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ —Å–∏–ª—É, –∫—Ä–∏—Ç—ã –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø–æ–º–æ—â–Ω–∏–∫–∞</p>
    <p>‚ú® <strong>–†–µ–¥–∫–∏–µ –±–ª–æ–∫–∏</strong> ‚Äî –¥–∞—é—Ç –±–æ–Ω—É—Å—ã –∏ –æ–≥—Ä–æ–º–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã!</p>
    <button id="continueBtn" class="btn no-save">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    <button id="startBtn" class="btn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    <button id="langBtn-welcome" title="–°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫">
      <span id="currentLangFlag">üá∑üá∫</span>
    </button>
  </div>
  
  <div id="saveScreen">
    <h2>–°–û–•–†–ê–ù–ï–ù–ò–ï –ò–ì–†–´</h2>
    <p>–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã –∏–ª–∏ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é?</p>
    <button id="loadSaveBtn" class="btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏–≥—Ä—É</button>
    <button id="newGameBtn" class="btn">–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É</button>
    <button id="cancelSaveBtn" class="btn" style="background: #666;">–û—Ç–º–µ–Ω–∞</button>
  </div>
  
  <div id="gameOverScreen">
    <h2>–î–û–ë–´–ß–ê –ü–†–ï–†–í–ê–ù–ê!</h2>
    <div id="finalScore">–í—Å–µ–≥–æ —É—Ä–æ–Ω–∞: 0</div>
    <button id="restartBtn">–ù–æ–≤–∞—è –¥–æ–±—ã—á–∞</button>
    <button id="shareBtn">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
  <script src="js/translations.js"></script>
  <script src="js/save-system.js"></script>
  <script src="js/planet-background.js"></script>
  <script src="js/game-logic.js"></script>
  <script src="js/shop.js"></script>
  <script src="js/achievements.js"></script>
  
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    function initTelegram() {
      if (window.Telegram && window.Telegram.WebApp) {
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        console.log('Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:', {
          platform: tg.platform,
          version: tg.version,
          initData: tg.initData
        });
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–µ–º—É
        document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#000000');
        document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#ffffff');
        document.documentElement.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color || '#4CAF50');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
        window.tg = tg;
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –Ω–∞ GitHub Pages
    function isGitHubPages() {
      return window.location.hostname.includes('github.io');
    }
    
    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø—É—Ç–µ–π –¥–ª—è GitHub Pages
    function adaptPathsForGitHubPages() {
      if (isGitHubPages()) {
        console.log('GitHub Pages detected, adapting paths...');
        const basePath = '/kosmicheskiy_klikker/';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç–∏ –∫ –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞–º
        const audioFiles = ['clickSound', 'breakSound', 'upgradeSound', 'comboSound', 'helperSound'];
        audioFiles.forEach(id => {
          const audio = document.getElementById(id);
          if (audio && audio.src) {
            const currentSrc = audio.src.split('/').pop();
            audio.src = basePath + 'audio/' + currentSrc;
          }
        });
      }
    }
    
    // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
      console.log('=== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ö–û–°–ú–ò–ß–ï–°–ö–û–ì–û –ö–õ–ò–ö–ï–†–ê ===');
      console.log('Host:', window.location.hostname);
      console.log('GitHub Pages:', isGitHubPages());
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
      initTelegram();
      
      // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –ø—É—Ç–∏ –¥–ª—è GitHub Pages
      adaptPathsForGitHubPages();
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω–æ–≥–æ —Ñ–æ–Ω–∞
      if (window.planetBackground && window.planetBackground.init) {
        window.planetBackground.init();
      }
      
      // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
      setTimeout(function() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ gameState –∏ gameMetrics
        if (!window.gameState || !window.gameMetrics) {
          console.warn('gameState –∏–ª–∏ gameMetrics –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã, —Å–æ–∑–¥–∞–µ–º...');
          if (!window.gameState) window.gameState = {};
          if (!window.gameMetrics) window.gameMetrics = {};
        }
        
        console.log('–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:', {
          coins: window.gameState.coins,
          damage: window.gameState.totalDamageDealt,
          location: window.gameState.currentLocation,
          platform: window.Telegram ? 'Telegram' : 'Web'
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
        if (typeof window.updateContinueButton === 'function') {
          window.updateContinueButton();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º—ã
        if (window.achievementsSystem && window.achievementsSystem.init) {
          window.achievementsSystem.init();
        }
        
        if (window.shopSystem && window.shopSystem.init) {
          window.shopSystem.init();
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤—É—é –ª–æ–≥–∏–∫—É
        if (window.gameFunctions && window.gameFunctions.updateHUD) {
          window.gameFunctions.updateHUD();
          window.gameFunctions.updateUpgradeButtons();
          window.gameFunctions.setLocation(window.gameState.currentLocation || 'mercury');
        }
        
        if (typeof window.updateLanguageFlag === 'function') {
          window.updateLanguageFlag();
        }
        
        if (typeof window.updateAllTranslations === 'function') {
          window.updateAllTranslations();
        }
        
        console.log('‚úÖ –ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        
        // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(() => {
          const loadingScreen = document.getElementById('welcomeScreen');
          if (loadingScreen) {
            loadingScreen.style.opacity = '1';
          }
        }, 500);
        
      }, 300);
      
      // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∂–µ—Å—Ç–æ–≤
      document.addEventListener('touchstart', function(e) {
        if (e.touches.length > 1) e.preventDefault();
      }, { passive: false });
      
      document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
      }, { passive: false });
      
      document.addEventListener('gesturechange', function(e) {
        e.preventDefault();
      }, { passive: false });
      
      document.addEventListener('gestureend', function(e) {
        e.preventDefault();
      }, { passive: false });
    });
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    window.debugSave = function() {
      const saved = localStorage.getItem('cosmicBlocksSave');
      console.log('=== –î–ï–ë–ê–ì –°–û–•–†–ê–ù–ï–ù–ò–Ø ===');
      
      if (saved) {
        try {
          const data = JSON.parse(saved);
          console.log('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ:', {
            timestamp: new Date(data.timestamp).toLocaleString(),
            coins: data.gameState?.coins,
            damage: data.gameState?.totalDamageDealt,
            location: data.gameState?.currentLocation,
            version: data.version
          });
        } catch (e) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', e);
        }
      } else {
        console.log('‚ùå –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
      }
    };
  </script>
</body>
</html>